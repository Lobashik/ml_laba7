# Face Search - Система поиска лиц

Система распознавания лиц с использованием эмбеддингов, PostgreSQL (pgvector) и веб-интерфейсом на FastAPI.

## Задания

### Задание 1: Распознавание лиц в реальном времени
Файл `1.py` содержит решение первого задания - систему распознавания лиц в реальном времени с использованием OpenCV и моделей YuNet + SFace. Приложение захватывает видео с веб-камеры, детектирует лица и сравнивает их с эталонным изображением.

видео - https://cloud.mail.ru/public/MN9N/H46ejj7Ln

### Задание 2: Система поиска лиц с веб-интерфейсом
Docker Compose и связанные файлы (`docker-compose.yml`, `app.py`, `face_search.py`, `Dockerfile`) реализуют второе задание - полнофункциональную систему поиска лиц с использованием эмбеддингов FaceNet, базы данных PostgreSQL с pgvector и современного веб-интерфейса на FastAPI.

видео - https://cloud.mail.ru/public/KLJd/25rhNqyAY

## Возможности

- ✅ Создание эмбеддингов лиц с помощью FaceNet (DeepFace)
- ✅ Хранение эмбеддингов в PostgreSQL с расширением pgvector
- ✅ Быстрый поиск ближайших соседей с помощью векторного поиска
- ✅ Современный веб-интерфейс с drag & drop
- ✅ REST API для интеграции

## Установка

### 1. Запуск базы данных

```bash
docker-compose up -d
```

### 2. Установка зависимостей

```bash
pip install -r requirements.txt
```

### 3. Создание эмбеддингов

Запустите скрипт для создания эмбеддингов из CSV файла:

```bash
python face_search.py
```

Убедитесь, что у вас есть:
- `hse_faces_miem/staff_photo.csv` - CSV файл с колонками `filename` и `name`
- `hse_faces_miem/` - папка с изображениями лиц

### 4. Запуск веб-приложения

```bash
python app.py
```

Или через uvicorn:

```bash
uvicorn app:app --reload --host 0.0.0.0 --port 8000
```

Приложение будет доступно по адресу: http://localhost:8000

## API Endpoints

### GET /
Главная страница с веб-интерфейсом для загрузки изображений

### POST /search
Поиск лица по изображению

**Параметры:**
- `file` - файл изображения (multipart/form-data)

**Ответ:**
```json
{
  "name": "Иван Иванов",
  "distance": 0.3456
}
```

### GET /stats
Статистика базы данных

**Ответ:**
```json
{
  "total_embeddings": 150
}
```

## Структура проекта

```
.
├── app.py                    # FastAPI веб-приложение
├── face_search.py            # Скрипт создания эмбеддингов
├── docker-compose.yml        # Docker Compose для PostgreSQL
├── init.sql                  # SQL скрипт инициализации БД
├── requirements.txt          # Python зависимости
└── hse_faces_miem/
    ├── staff_photo.csv       # CSV с данными сотрудников
    └── *.jpg                 # Изображения лиц
```

## Технологии

- **FastAPI** - современный веб-фреймворк для Python
- **DeepFace** - библиотека для распознавания лиц (FaceNet)
- **PostgreSQL + pgvector** - база данных с поддержкой векторного поиска
- **OpenCV** - обработка изображений
- **Docker** - контейнеризация базы данных

## Примечания

- Размер эмбеддинга FaceNet: 128 измерений
- Используется L2 distance для поиска ближайших соседей
- Чем меньше distance, тем выше сходство между лицами
- Рекомендуется использовать изображения с одним четким лицом

## Настройка

Параметры подключения к БД можно изменить в файлах:
- `face_search.py` - строка подключения
- `app.py` - строка подключения
- `docker-compose.yml` - переменные окружения PostgreSQL

## Требования

- Python 3.8+
- Docker & Docker Compose
- 2GB+ RAM для моделей DeepFace
